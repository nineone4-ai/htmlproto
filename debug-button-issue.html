<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ—è¡¨æ¨¡å¼æŒ‰é’®æ˜¾ç¤ºé—®é¢˜è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .debug-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background-color: #fff;
            border-left: 4px solid #ff6b6b;
        }
        .check-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background-color: #fff;
            border-left: 4px solid #51cf66;
        }
        .status-icon {
            font-size: 20px;
            margin-top: 2px;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .highlight {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .solution {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .test-steps {
            background-color: #e2e3e5;
            border: 1px solid #d6d8db;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ› åˆ—è¡¨æ¨¡å¼æŒ‰é’®æ˜¾ç¤ºé—®é¢˜è°ƒè¯•æŠ¥å‘Š</h1>
    
    <div class="debug-section">
        <div class="debug-title">ğŸ” é—®é¢˜æè¿°</div>
        
        <div class="issue-item">
            <span class="status-icon">âŒ</span>
            <div>
                <strong>ä¸»è¦é—®é¢˜</strong>
                <div style="margin-top: 5px; color: #666;">
                    åœ¨åˆ—è¡¨æˆ–å¤é€‰æ¡†åˆ—è¡¨æ¨¡å¼ä¸‹ï¼Œé€šè¿‡ç»„ä»¶ä¾§è¾¹æ æ·»åŠ æ™®é€šæŒ‰é’®æ—¶ï¼ŒæŒ‰é’®æ²¡æœ‰æ­£ç¡®æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š
                </div>
            </div>
        </div>
        
        <div class="issue-item">
            <span class="status-icon">âŒ</span>
            <div>
                <strong>é¢„æœŸè¡Œä¸º</strong>
                <div style="margin-top: 5px; color: #666;">
                    æŒ‰é’®åº”è¯¥ä¸"å¯¼å…¥å­—æ®µ"æŒ‰é’®åœ¨åŒä¸€è¡Œï¼Œå±…å·¦æ˜¾ç¤º
                </div>
            </div>
        </div>
        
        <div class="issue-item">
            <span class="status-icon">âŒ</span>
            <div>
                <strong>å®é™…è¡Œä¸º</strong>
                <div style="margin-top: 5px; color: #666;">
                    æŒ‰é’®æ·»åŠ åæ²¡æœ‰åœ¨åˆ—è¡¨ç•Œé¢çš„å¤´éƒ¨åŒºåŸŸæ˜¾ç¤ºå‡ºæ¥
                </div>
            </div>
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ”§ ä»£ç æµç¨‹åˆ†æ</div>
        
        <div class="check-item">
            <span class="status-icon">âœ…</span>
            <div>
                <strong>1. æŒ‰é’®æ·»åŠ é€»è¾‘ (app/page.tsx:131-178)</strong>
                <div style="margin-top: 5px; color: #666;">
                    handleAddComponent å‡½æ•°æ­£ç¡®å¤„ç†æŒ‰é’®æ·»åŠ åˆ° layoutItems[].components æ•°ç»„
                </div>
            </div>
        </div>
        
        <div class="code-block">
const handleAddComponent = (component: any, itemId: string) => {
  const newComponent = {
    ...component,
    id: `${component.type}_${Date.now()}`,
    props: {
      label: `${component.label || component.type}`,
      required: false,
      disabled: false,
      ...component.props,
    },
  }

  setAppState((prev) => ({
    ...prev,
    layoutItems: prev.layoutItems.map((item) =>
      item.id === itemId ? { ...item, components: [...item.components, newComponent] } : item,
    ),
  }))
}
        </div>
        
        <div class="check-item">
            <span class="status-icon">âœ…</span>
            <div>
                <strong>2. ç»„ä»¶ä¼ é€’é€»è¾‘ (layout-preview.tsx:303)</strong>
                <div style="margin-top: 5px; color: #666;">
                    FormPreview ç»„ä»¶æ­£ç¡®æ¥æ”¶ item.components ä½œä¸º components å±æ€§
                </div>
            </div>
        </div>
        
        <div class="code-block">
&lt;FormPreview
  components={item.components}  // âœ… æ­£ç¡®ä¼ é€’ç»„ä»¶æ•°ç»„
  onSelectComponent={onSelectComponent}
  onDeleteComponent={(componentId) => onDeleteComponent(item.id, componentId)}
  // ... å…¶ä»–å±æ€§
  viewType={item.contentType}
  previewMode={previewMode}
/&gt;
        </div>
        
        <div class="check-item">
            <span class="status-icon">âœ…</span>
            <div>
                <strong>3. æŒ‰é’®è¿‡æ»¤é€»è¾‘ (form-preview.tsx:394)</strong>
                <div style="margin-top: 5px; color: #666;">
                    FormPreview ç»„ä»¶æ­£ç¡®è¿‡æ»¤å‡ºæŒ‰é’®ç»„ä»¶
                </div>
            </div>
        </div>
        
        <div class="code-block">
// åˆ†ç¦»æŒ‰é’®å’Œå…¶ä»–ç»„ä»¶
const buttons = components.filter((comp) => comp.type === "button")  // âœ… æ­£ç¡®è¿‡æ»¤
const otherComponents = components.filter((comp) => comp.type !== "button")
        </div>
        
        <div class="check-item">
            <span class="status-icon">âœ…</span>
            <div>
                <strong>4. åˆ—è¡¨æ¨¡å¼æ¸²æŸ“é€»è¾‘ (form-preview.tsx:423-440)</strong>
                <div style="margin-top: 5px; color: #666;">
                    åˆ—è¡¨æ¨¡å¼ä¸‹æ­£ç¡®æ£€æŸ¥ buttons.length å¹¶æ¸²æŸ“æŒ‰é’®
                </div>
            </div>
        </div>
        
        <div class="code-block">
{/* åˆ—è¡¨ä¸Šæ–¹çš„æŒ‰é’® - ä¸å¯¼å…¥å­—æ®µæŒ‰é’®åŒè¡Œï¼Œå±…å·¦æ˜¾ç¤º */}
{buttons.length > 0 && (  // âœ… æ­£ç¡®æ£€æŸ¥æŒ‰é’®æ•°é‡
  &lt;div className="flex flex-wrap gap-2"&gt;
    {buttons.map((component, index) => (  // âœ… æ­£ç¡®éå†æŒ‰é’®
      &lt;DraggableComponent
        key={component.id}
        component={component}
        // ... å…¶ä»–å±æ€§
      /&gt;
    ))}
  &lt;/div&gt;
)}
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ¤” å¯èƒ½çš„é—®é¢˜ç‚¹</div>
        
        <div class="highlight">
            <strong>å…³é”®ç–‘é—®ï¼š</strong>æ—¢ç„¶ä»£ç é€»è¾‘çœ‹èµ·æ¥éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä¸ºä»€ä¹ˆæŒ‰é’®æ²¡æœ‰æ˜¾ç¤ºï¼Ÿ
        </div>
        
        <div class="issue-item">
            <span class="status-icon">â“</span>
            <div>
                <strong>å¯èƒ½é—®é¢˜1ï¼šç»„ä»¶çŠ¶æ€æ›´æ–°</strong>
                <div style="margin-top: 5px; color: #666;">
                    æŒ‰é’®å¯èƒ½æ²¡æœ‰æ­£ç¡®æ·»åŠ åˆ°çŠ¶æ€ä¸­ï¼Œæˆ–è€…çŠ¶æ€æ›´æ–°æ²¡æœ‰è§¦å‘é‡æ–°æ¸²æŸ“
                </div>
            </div>
        </div>
        
        <div class="issue-item">
            <span class="status-icon">â“</span>
            <div>
                <strong>å¯èƒ½é—®é¢˜2ï¼šç»„ä»¶ç±»å‹åŒ¹é…</strong>
                <div style="margin-top: 5px; color: #666;">
                    æ·»åŠ çš„ç»„ä»¶ type å¯èƒ½ä¸æ˜¯ "button"ï¼Œå¯¼è‡´è¿‡æ»¤å¤±è´¥
                </div>
            </div>
        </div>
        
        <div class="issue-item">
            <span class="status-icon">â“</span>
            <div>
                <strong>å¯èƒ½é—®é¢˜3ï¼šå†…å®¹ç±»å‹æ£€æŸ¥</strong>
                <div style="margin-top: 5px; color: #666;">
                    å¯èƒ½å­˜åœ¨å†…å®¹ç±»å‹æ£€æŸ¥é€»è¾‘é˜»æ­¢äº†æŒ‰é’®åœ¨åˆ—è¡¨æ¨¡å¼ä¸‹æ˜¾ç¤º
                </div>
            </div>
        </div>
        
        <div class="issue-item">
            <span class="status-icon">â“</span>
            <div>
                <strong>å¯èƒ½é—®é¢˜4ï¼šCSSæ ·å¼é—®é¢˜</strong>
                <div style="margin-top: 5px; color: #666;">
                    æŒ‰é’®å¯èƒ½è¢«æ¸²æŸ“äº†ä½†æ˜¯è¢«CSSéšè—æˆ–è€…ä½ç½®ä¸æ­£ç¡®
                </div>
            </div>
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ” è°ƒè¯•å»ºè®®</div>
        
        <div class="test-steps">
            <h4>è°ƒè¯•æ­¥éª¤ï¼š</h4>
            <ol>
                <li><strong>æ£€æŸ¥ç»„ä»¶çŠ¶æ€</strong>ï¼šåœ¨ FormPreview ç»„ä»¶ä¸­æ·»åŠ  console.log è¾“å‡º components å’Œ buttons æ•°ç»„</li>
                <li><strong>éªŒè¯æŒ‰é’®æ·»åŠ </strong>ï¼šåœ¨ handleAddComponent ä¸­æ·»åŠ  console.log ç¡®è®¤æŒ‰é’®è¢«æ­£ç¡®æ·»åŠ </li>
                <li><strong>æ£€æŸ¥ç»„ä»¶ç±»å‹</strong>ï¼šç¡®è®¤æ·»åŠ çš„æŒ‰é’®ç»„ä»¶çš„ type å±æ€§ç¡®å®æ˜¯ "button"</li>
                <li><strong>éªŒè¯æ¸²æŸ“æ¡ä»¶</strong>ï¼šæ£€æŸ¥ buttons.length > 0 æ¡ä»¶æ˜¯å¦æ»¡è¶³</li>
                <li><strong>æ£€æŸ¥CSSæ ·å¼</strong>ï¼šä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥æŒ‰é’®å…ƒç´ æ˜¯å¦å­˜åœ¨ä½†è¢«éšè—</li>
            </ol>
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ</div>
        
        <div class="solution">
            <h4>æ–¹æ¡ˆ1ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—</h4>
            <p>åœ¨å…³é”®ä½ç½®æ·»åŠ  console.log æ¥è¿½è¸ªæ•°æ®æµï¼š</p>
            <div class="code-block">
// åœ¨ FormPreview ç»„ä»¶ä¸­æ·»åŠ 
console.log('FormPreview components:', components)
console.log('FormPreview buttons:', buttons)
console.log('FormPreview viewType:', viewType)

// åœ¨ handleAddComponent ä¸­æ·»åŠ 
console.log('Adding component:', newComponent)
console.log('Updated layoutItems:', updatedLayoutItems)
            </div>
        </div>
        
        <div class="solution">
            <h4>æ–¹æ¡ˆ2ï¼šæ£€æŸ¥ç»„ä»¶ä¾§è¾¹æ æŒ‰é’®å®šä¹‰</h4>
            <p>ç¡®è®¤ç»„ä»¶ä¾§è¾¹æ ä¸­æŒ‰é’®çš„å®šä¹‰æ˜¯å¦æ­£ç¡®ï¼š</p>
            <div class="code-block">
// æ£€æŸ¥ component-sidebar.tsx ä¸­çš„æŒ‰é’®å®šä¹‰
onClick={() =>
  onAddComponent(
    {
      type: "button",  // âœ… ç¡®ä¿è¿™é‡Œæ˜¯ "button"
      icon: &lt;ButtonIcon className="h-4 w-4 mr-2" /&gt;,
      label: button.text,
      props: {
        text: button.text,
        color: button.color,
      },
    },
    selectedItemId,
  )
}
            </div>
        </div>
        
        <div class="solution">
            <h4>æ–¹æ¡ˆ3ï¼šå¼ºåˆ¶é‡æ–°æ¸²æŸ“</h4>
            <p>å¦‚æœæ˜¯çŠ¶æ€æ›´æ–°é—®é¢˜ï¼Œå¯ä»¥å°è¯•å¼ºåˆ¶é‡æ–°æ¸²æŸ“ï¼š</p>
            <div class="code-block">
// åœ¨çŠ¶æ€æ›´æ–°åæ·»åŠ å¼ºåˆ¶æ›´æ–°
setAppState((prev) => ({
  ...prev,
  layoutItems: prev.layoutItems.map((item) =>
    item.id === itemId ? { ...item, components: [...item.components, newComponent] } : item,
  ),
  // æ·»åŠ ä¸€ä¸ªæ—¶é—´æˆ³å¼ºåˆ¶æ›´æ–°
  lastUpdate: Date.now()
}))
            </div>
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ“‹ æµ‹è¯•æ¸…å•</div>
        
        <div class="test-steps">
            <h4>æµ‹è¯•æ­¥éª¤ï¼š</h4>
            <ol>
                <li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µ/æŠ˜å é¡¹/å¡ç‰‡</li>
                <li>è®¾ç½®å†…å®¹ç±»å‹ä¸º"åˆ—è¡¨"</li>
                <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°</li>
                <li>ä»ç»„ä»¶ä¾§è¾¹æ æ·»åŠ ä¸€ä¸ªé»˜è®¤æŒ‰é’®ï¼ˆå¦‚"æ–°å¢"ï¼‰</li>
                <li>æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºï¼Œç¡®è®¤ï¼š
                    <ul>
                        <li>æŒ‰é’®æ˜¯å¦è¢«æ·»åŠ åˆ° components æ•°ç»„</li>
                        <li>buttons æ•°ç»„æ˜¯å¦åŒ…å«æ·»åŠ çš„æŒ‰é’®</li>
                        <li>buttons.length æ˜¯å¦å¤§äº 0</li>
                        <li>æ˜¯å¦è¿›å…¥äº†æŒ‰é’®æ¸²æŸ“é€»è¾‘</li>
                    </ul>
                </li>
                <li>æ£€æŸ¥DOMå…ƒç´ ï¼Œç¡®è®¤æŒ‰é’®å…ƒç´ æ˜¯å¦å­˜åœ¨</li>
                <li>é‡å¤æµ‹è¯•å¤é€‰æ¡†åˆ—è¡¨æ¨¡å¼</li>
            </ol>
        </div>
    </div>

    <div style="text-align: center; margin-top: 30px; padding: 20px; background-color: #fff3cd; border-radius: 8px; border: 1px solid #ffeaa7;">
        <strong>ğŸ” ä¸‹ä¸€æ­¥ï¼šéœ€è¦æ·»åŠ è°ƒè¯•æ—¥å¿—æ¥ç¡®å®šå…·ä½“çš„é—®é¢˜ç‚¹</strong>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ› åˆ—è¡¨æ¨¡å¼æŒ‰é’®æ˜¾ç¤ºé—®é¢˜è°ƒè¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“‹ è¯·æŒ‰ç…§è°ƒè¯•å»ºè®®è¿›è¡Œé—®é¢˜æ’æŸ¥');
        });
    </script>
</body>
</html>
